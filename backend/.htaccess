# ===========================================

# Passenger Node.js Application Configuration

# ===========================================

PassengerEnabled on
PassengerAppType node
PassengerAppRoot "/home/cygmhbrr/server.soukboudouaou.com"
PassengerBaseURI "/"
PassengerStartupFile server.js
PassengerNodejs "/home/cygmhbrr/nodevenv/server.soukboudouaou.com/24/bin/node"

# Passenger Application Environment

PassengerAppEnv production
PassengerFriendlyErrorPages off
PassengerMaxPoolSize 6
PassengerMinInstances 1

# ===========================================

# Security Headers

# ===========================================

<IfModule mod_headers.c>
  # Security Headers (backup - your Helmet.js handles these too)
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "DENY"
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  
  # CORS Headers (if needed - Express cors() should handle these)
  # Uncomment and customize if you need .htaccess level CORS:
  # Header always set Access-Control-Allow-Origin "https://yourdomain.com"
  # Header always set Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
  # Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
  # Header always set Access-Control-Allow-Credentials "true"
  # Header always set Access-Control-Max-Age "86400"
</IfModule>

# ===========================================

# File Access Protection

# ===========================================

Options -Indexes

<IfModule mod_authz_core.c>
  # Protect .env file
  <FilesMatch "^\.env">
    Require all denied
  </FilesMatch>

  # Protect log files
  <FilesMatch "\.(log)$">
    Require all denied
  </FilesMatch>

  # Protect package files (optional)
  <FilesMatch "^(package\.json|package-lock\.json)$">
    Require all denied
  </FilesMatch>

  # Protect .htaccess itself
  <Files ".htaccess">
    Require all denied
  </Files>

  # Block script execution (safety hardening)
  <FilesMatch "\.(php|phtml|php3|php4|php5|pl|py|jsp|asp|html|htm|shtml|sh|cgi)$">
    Require all denied
  </FilesMatch>
</IfModule>

# ===========================================

# Performance Optimization

# ===========================================

<IfModule mod_deflate.c>
  # Compress text files
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

<IfModule mod_expires.c>
  ExpiresActive On
  
  # Cache static assets (if serving any via Express static)
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/gif "access plus 1 month"
  ExpiresByType image/webp "access plus 1 month"
  ExpiresByType text/css "access plus 1 week"
  ExpiresByType application/javascript "access plus 1 week"
</IfModule>

# ===========================================

# Error Handling

# ===========================================

# Passenger will handle errors, but you can customize:

# ErrorDocument 404 /404.html

# ErrorDocument 500 /500.html

# ===========================================

# Additional Security

# ===========================================

# Disable server signature

ServerSignature Off

# Limit file upload size (adjust as needed)

LimitRequestBody 26214400

# Prevent clickjacking

<IfModule mod_headers.c>
  Header always append X-Frame-Options DENY
</IfModule>

# ===========================================

# Environment Variables (OPTIONAL)

# ===========================================

#

# RECOMMENDED: Set sensitive variables in cPanel Application Manager instead!

# Only use these for non-sensitive configuration:

#

# SetEnv NODE_ENV production

# SetEnv API_ORIGIN https://server.yourdomain.com

# SetEnv APP_ORIGIN https://yourdomain.com

# SetEnv COOKIE_DOMAIN yourdomain.com

# SetEnv COOKIE_SECURE true

# SetEnv COOKIE_SAMESITE lax

#

# NEVER put these in .htaccess (use cPanel instead):

# ❌ DATABASE_URL

# ❌ JWT_SECRET

# ❌ JWT_REFRESH_SECRET

# ❌ SMTP credentials

# ===========================================

# Restart Application

# ===========================================

#

# To restart your application:

# 1. SSH: touch /home/cygmhbrr/newbackend/backend/tmp/restart.txt

# 2. SSH: passenger-config restart-app /home/cygmhbrr/newbackend/backend

# 3. cPanel: Node.js App Manager → Click "RESTART"

#

# ===========================================
